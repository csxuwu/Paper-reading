**阅读**：2019.7.22-7.31<br />**期刊**：ECCV 2016<br />**引用**：Liu W, Anguelov D, Erhan D, et al. SSD: Single Shot MultiBox Detector[J]. In European conference on computer vision, pages 21–37.Springer, 2016.

---

![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345590574-3fd436bb-b4f9-49a3-8208-2ebd8715711c.png#crop=0&crop=0&crop=1&crop=1&height=347&id=nyhGw&originHeight=746&originWidth=1322&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=615)<br />图3.1 SSD结构图
<a name="Vh6KC"></a>
# 1 SSD概述

---

SSD 是“one-stage”目标检测算法。准确率比“Faster R-CNN”高，检测速度比“YOLO V1”快，如图3.2所示。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345590924-7a6f8650-8498-4c36-9098-46e71e643e70.jpeg#crop=0&crop=0&crop=1&crop=1&height=206&id=Glcig&originHeight=355&originWidth=474&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=275)<br />图3.2 不同目标检测算法的测试速度和mAP比较<br />通过将**不同大小的特征图**送入检测器，大的特征图（浅层）具有跟高的分辨率，包含更多的细节信息，适合检测小尺度物体，小的特征图（深层）具有更强的语义信息，能光滑分割结果，适合检测大尺度物体，从而增强了对“多尺度”物体的检测能力（这个思想与FPN类似）；采用了不同尺度和宽高比的**先验框**（default boxes，类似Faster R-CNN的anchor）；采用数据增强技术，提升SSD对小目标的检测性能。从而提升了检测准确率。<br />通过去除RPN网络及后续的像素或特征重采样阶段、使用多个卷积层的输出来做分类和位置回归（而不是用FC），提高了检测速度。
<a name="BjMPq"></a>
# 2 创新点

---

1. 将不同尺寸的特征图送入检测器<br />2. 采用小卷积核的卷积层进行分类预测和位置回归
<a name="Xa2kZ"></a>
# 3 The Single Shot Detector(SSD)

---

<a name="UbTPq"></a>
## 3.1 Model
SSD特征提取网络设计的核心思想是“特征分层提取”，将一系列不同尺寸的特征送入检测器，依次进行分类和边界框回归，从而增强算法“多尺度”检测能力。算法流程如下：<br />（1）特征提取网络生成6种不同尺寸的特征图{P1,P2,P3,P4,P5,P6}；<br />（2）将{P1,P2,P3,P4,P5,P6}送入检测器，在每张特征图上生成同时进行三种操作：<br />	a) 每张的特征图的每个cell都生成k个“default box”<br />	b) 采用卷积操作，对每个“default box”进行分类预测<br />	c) 采用卷积操作，计算每个“default box”的offset<br />（3）筛选每张特征图产生的边界框（bounding box,bbox）<br />a) 筛选超出图像边界的bbox<br />b) NMS筛选<br />（4）汇总所有预测的bbox，再使用NMS筛选，得出最终的检测结果<br />**1. Multi-scale feature maps for detection**<br />SSD每个模块的输出特征图逐步缩小，将新添加的每个卷积模块的最后一层输出都送到检测器中（如图3.3红框内所示），**即将不同尺寸的特征图送入检测器**。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345591615-a2be7f1d-b274-438f-8d82-3bfd348a3819.png#crop=0&crop=0&crop=1&crop=1&id=E99nQ&originHeight=324&originWidth=1505&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />图3.3 SSD网络结构<br />**大的特征图（浅层）具有跟高的分辨率，包含更多的细节信息，适合检测小尺度物体，小的特征图（深层）具有更强的语义信息，能光滑分割结果，适合检测大尺度物体**，所以能够增强“多尺度”检测能力。如图3.4所示，左边浅层的特征图尺寸较大，anchor覆盖区域远比gt_box小，IoU值较小；右边深层的特征图尺寸比较小，anchor覆盖区域较大远超gt_box范围，IoU值也较小；中间的特征图大小比较合适，anchor与gt_box的IoU值较大[3]。通过同时对多个层次的特征图上的anchor计算IoU，能够找到与gt_box尺寸、位置最接近的anchor<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345591980-751fc873-a564-4a59-9d91-2247b6eea0ca.jpeg#crop=0&crop=0&crop=1&crop=1&height=223&id=nec3m&originHeight=321&originWidth=700&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=486)<br />图3.4 不同尺寸特征图对目标检测的影响比较[3]<br />**2. Convolutional predictors for detection**<br />采用“3x3 conv”计算每张特征图的每个cell的“分类得分”和“bbox偏移量”。如输入的特征图为m*n*p，那么filter为“3*3*p”，这也是一个“detector/classifier”的参数量，它的输出是对应bbox的“分类得分”或者“bbox偏移量”，如图3.5所示。具体用于计算分类得分和bbox 偏移量的filter数量在“Default boxes and aspect ratio”小结会提到。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345592546-661655e9-d7f4-4b5e-b692-25fa440e97ff.png#crop=0&crop=0&crop=1&crop=1&height=254&id=nMBLk&originHeight=296&originWidth=615&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=527)<br />图3.5 采用卷积操作计算“分类得分”和“bbox偏移量”[4]<br />**3. Default boxes and aspect ratio**<br />特征提取阶段将6个不同尺寸的特征图送入检测器，每个特征图的每个cell都生成k个default box，如图3.6所示。在SSD中，default box的scale不需要人为给定，而是通过送入不同尺寸的特征图而确定的，但aspect ratio仍需要人为给定：{1, 2, 3, 1/2, 1/3}。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345592945-c0b9ae27-a0d5-4b2b-8bf3-04bdc7eb5864.png#crop=0&crop=0&crop=1&crop=1&height=219&id=Kd2A0&originHeight=339&originWidth=631&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=408)<br />图3.6 SSD生成default box[4]<br />计算分类得分和bbox偏移量的filter数量如下：<br />（1）default box共有c个类别，实际有（c-1）个类别，加上一个“前景/背景”类别；<br />（2）bbox偏移量由中间坐标和bbox宽高的偏移量组成，共4个数值。<br />所以每个cell需要“（c+4）*k”个filter，用于计算分类得分、bbox偏移量。一个m*n的特征图需要“（c+4）*k*mn”个filter，如图3.7所示，假设m=n=5，k=6，c=1。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345593608-1dff77a4-1542-46dc-ad20-fbb7aba15683.jpeg#crop=0&crop=0&crop=1&crop=1&height=264&id=q5V0J&originHeight=366&originWidth=656&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=473)<br />图3.7 预测框分类、偏移量特征向量的生成
<a name="Ttrba"></a>
## 3.2 Training
**1. Matching strategy**<br />（1）default box与gt_box匹配策略

   1. 确保每个gt_box都有个default box匹配。对于gt_box，找到与其IoU最大的default box，并与之匹配。通常，称与gt_box匹配的default box为正样本（其实是最终的bbox，但default box与bbox是一一对应的）。反之，如果一个default box没有与任何gt_box匹配，那么该default box只能与背景匹配，即负样本。
   1. 对于剩下未匹配的default box，若与某个gt_box的IoU大于某个阈值（通常为0.5），则该default就与这个gt_box匹配。这意味着，一个gt_box可以与多个default box匹配；但一个default box只与一个gt_box匹配，如果一个default box与多个gt_box的IoU大于阈值，则default box只与IoU最大的gt_box匹配。

注意：b策略在a之后：<br />		如果只有a)，则大量的default box都为负样本，正负样本极不平衡。<br />		如果某个gt_box对应的最大IoU小于阈值，且所匹配的default box与另一gt_box的IoU大于阈值，那么default box应当优先与前一个gt_box匹配，因为首先要确定gt_box与一个default box匹配。

计算default box与gt_box之间的IoU，IoU>0.5，则gt_box与该default box匹配，所有匹配的default box全用于前景分类；在IoU<0.5的default box中选择部分作为背景分类。该策略简化了学习难度，**允许一个default box匹配多个gt_box，IoU超过阈值即可，而不仅取IoU最大的gt_box。**这与YOLO系列是不同，YOLO系列是一个gt_box只对应一个bbox。<br />**（2）定位策略**<br />default box\gt_box\prediction bounding box(bbpx)之间的变换关系如图3.8所示，与越接近，bbox与gt_box越接近。<br />		![](https://cdn.nlark.com/yuque/__latex/667b417d65156212dcfe27bd869c778a.svg#card=math&code=I%5E%2A&id=lwOhX)：default box与gt_box的变换关系，即偏移量<br />		g^*：bbox与 gt_box的变换关系，即偏移量<br />		![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345594764-bc4aa788-6757-4326-9bf4-dd621cb62669.png#crop=0&crop=0&crop=1&crop=1&height=155&id=BfXOb&originHeight=248&originWidth=694&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=434)<br />图3.8 default box\gt_box\prediction bounding box(bbpx)之间的变换关系[2]<br />**2. Training objective**<br />SSD的损失函数由定位回归损失和分类损失构成，如公式3.1所示。损失计算示意图如3.10所示。<br />![](https://cdn.nlark.com/yuque/__latex/c26ca077e7469a08cfeb5b35e14bddfe.svg#card=math&code=L%28x%2Cc%2Cl%2Cg%29%3D%5Cfrac%7B1%7D%7BN%7D%28L_%7Bconf%7D%28x%2Cc%29%2B%5Calpha_%7Bloc%7D%28x%2Cl%2Cg%29%29&id=fLCla)（公式3.1）<br />	![](https://cdn.nlark.com/yuque/__latex/8d9c307cb7f3c4a32822a51922d1ceaa.svg#card=math&code=N&id=EFUJQ)：与gt_box匹配成功的default box数量；若N=0，则loss=0<br />	![](https://cdn.nlark.com/yuque/__latex/7b7f9dbfea05c83784f8b85149852f08.svg#card=math&code=%5Calpha&id=WsqK6)：前景loss与背景loss 的调节比例，论文中设置为1<br />	（1）定位回归损失<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345595710-aa7edb47-7f89-4c18-bceb-1fdf743ce59a.png#crop=0&crop=0&crop=1&crop=1&height=144&id=ZCS1J&originHeight=291&originWidth=377&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=186)<br />图3.9 Smooth L1 loss<br />定位回归损失只用于前景的bbox（正样本），因为对于定位而言，只要回归得到精确的变换关系即可，预测时不需要区分正负样本，而是交给分类损失来完成，将得到的变换关系用于所有的default box[2]。<br />与Faster R-CNN采用相同的损失函数，即Smooth L1 loss，其对离群点具有更强的鲁棒性，在x=0处不可导，使用近似表达，如图3.9所示，计算如公式3.2、3.3、3.4所示。bbox与gt_box之间的偏移量计算如公式3.4所示，如图3.8所示，通过**不断地最小化两个“偏移量”，促使bbox不断靠近gt_box**。<br />![](https://cdn.nlark.com/yuque/__latex/3e5dbd6b69d09918ff61014fc771beb1.svg#card=math&code=L_%7Bloc%7D%28x%2Cl%2Cg%29%3D%5Csum%5E%7BN%7D_%7Bi%5Cin%20Pos%7D%20%5Csum_%7Bm%5Cin%7Bcx%2Cxy%2Cw%2Ch%7D%7D%20x_%7Bi%2Cj%7D%5Ek%20smooth_%7BL1%7D%28l%5Em_i%20-%20%5Chat%7Bg%7D%5Em_j%29&id=l5j1O)（公式3.2）<br />![](https://cdn.nlark.com/yuque/__latex/2e72fb7d35c0353ca0b2c5f8546ce628.svg#card=math&code=smooth_%7BL1%7D%28x%29%3D%5Cbegin%7Bcases%7D%200.5x%5E2%20%26%20if%20%7Cx%7C%3C1%5C%5C%20%7Cx%7C-0.5%20%26%20otherwise%20%20x%3D0%20%5Cend%7Bcases%7D&id=dA1mo)（公式3.3）<br />				![](https://cdn.nlark.com/yuque/__latex/bac5cbe4995390d82596b3dac5d27c89.svg#card=math&code=%5Cbegin%7Bcases%7D%20%0A%5Chat%7Bg%7D%5E%7Bcx%7D_j%20%3D%20%5Cfrac%7Bg%5E%7Bcx%7D_j-d%5E%7Bcx%7D_i%7D%7Bd%5Ew_i%7D%2C%0A%5Chat%7Bg%7D%5E%7Bcy%7D_j%20%3D%20%5Cfrac%7Bg%5E%7Bcy%7D_j-d%5E%7Bcy%7D_i%7D%7Bd%5Eh_i%7D%20%5C%5C%0A%5Chat%7Bg%7D%5Ew_j%3Dlog%28%5Cfrac%7Bg%5Ew_j%7D%7Bd%5Ew_i%7D%29%2C%5Chat%7Bg%7D%5Eh_j%3Dlog%28%5Cfrac%7Bg%5Eh_j%7D%7Bd%5Eh_i%7D%29%20%0A%5Cend%7Bcases%7D&id=eqFle)（公式3.4）

		![](https://cdn.nlark.com/yuque/__latex/711c9055c7faa6d38fb7acac41c192f2.svg#card=math&code=l%5Em_i&id=mGmR9)：default box与gt_box之间的偏移量<br />		![](https://cdn.nlark.com/yuque/__latex/11773e6749af2213d8fb5e98e2d7c2d2.svg#card=math&code=%5Chat%7Bg%7D%5Em_j&id=i4h59)：bbox与gt_box之间的偏移量<br />	（2）分类损失<br />是前景、背景分类的损失之和，采用softmax，交叉熵损失。如公式3.5所示。<br />					![](https://cdn.nlark.com/yuque/__latex/ae53a9c611045c57b9a8cbad06e29b67.svg#card=math&code=%5Cbegin%7Bcases%7D%0AL_%7Bconf%7D%28x%2Cc%29%3D-%5Csum_%7Bi%20%5Cin%20Pos%7D%5EN%7Bx%5Ep_%7Bij%7Dlog%28%5Chat%7Bc%7D%5Ep_i%29%7D-%5Csum_%7Bi%20%5C%20in%20Neg%7D%7Blog%28%5Chat%7Bc%7D%5E0_i%29%7D%5C%5C%0A%5Chat%7Bc%7D%5Ep_i%3D%5Cfrac%7Bexp%28c%5Ep_i%29%7D%7B%5Csum_p%7Bexp%28c%5Ep_i%29%7D%7D%0A%5Cend%7Bcases%7D&id=MawZ2)（公式3.5）

![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345598273-ff7c8e5f-9b7b-428b-a3a3-f7142c78dc00.jpeg#crop=0&crop=0&crop=1&crop=1&height=382&id=HT7Dr&originHeight=543&originWidth=700&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=492)<br />图3.10 SSD损失计算示意图[3]<br />**3. Choosing scales and aspect ratios for default boxes**<br />（1）scale<br />3.3.1小结详细分析了利用不同尺寸特征图实现不同scales的理论依据。不同层次、尺寸的特征图应有不同大小（scale）的default box（如图3.11所示），计算方法如公式3.6所示。在SSD源代码中，每个cell首先生成一大一小的两个正方形default box，小方形边长为min_size，大方形边长为![](https://cdn.nlark.com/yuque/__latex/d48361325ac5cb6b823189f67a6c1437.svg#card=math&code=%5Csqrt%7Bmin_%7Bsize%7D%20%2A%20max_%7Bsize%7D%7D&id=r7zHQ) [3]，![](https://cdn.nlark.com/yuque/__latex/c6f3c2745e39c3294b025e5a4f8206ee.svg#card=math&code=min_%7Bsize%7D%2Cmax_%7Bsize%7D&id=ra02R)分别为公式3.6计算得到的最小、最大值。<br />				![](https://cdn.nlark.com/yuque/__latex/2effa949b1f4d614b13828cb67eb0fb1.svg#card=math&code=s_k%3Ds_%7Bmin%7D%2B%5Cfrac%7Bs_%7Bmax%7D-s_%7Bmin%7D%7D%7Bm-1%7D%28k-1%29%2Ck%20%5Cin%20%5B1%2Cm%5D&id=gdRq6)（公式3.6）<br />![](https://cdn.nlark.com/yuque/__latex/2881ccf1e2528b76512da60bf080ff63.svg#card=math&code=s_%7Bmin%7D%3D0.2&id=BnBkx)，即最底层的scale为0.2；![](https://cdn.nlark.com/yuque/__latex/fad3a64045a67ffba53f6b474192a470.svg#card=math&code=s_%7Bmax%7D%3D0.9&id=J0reK)，即最顶层的scale为0.9；中间层的按照公式计算即可。每个特征图负责检测不同面积大小的物体。<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345599564-0141fedc-4d77-4db6-bec2-602547eb4907.jpeg#crop=0&crop=0&crop=1&crop=1&height=148&id=RxMhv&originHeight=240&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=396)<br />图3.11 不同尺寸的特征图具有不同尺寸的default box[1]<br />（2）aspect ratio<br />物体不仅有大小之分，宽高比（aspect ratio）也是有区别的，当两个物体的大小接近时，aspect ratio可能是不同的，SSD设定了几种aspect ratio ：{1, 2, 3, 1/2, 1/3}。当aspect ratio=1时，添加一种scale，即，则每个cell共有6个不同宽高比的default box。<br />利用scale、aspect ratio，结合公式就能计算出default box的真实宽高（如图3.11所示），计算如公式3.7所示，中心坐标计算公式如公式3.8所示，![](https://cdn.nlark.com/yuque/__latex/79e9f4d6dcf0826ad13f9d353c4ebedb.svg#card=math&code=%7Cf_k%7C&id=uM9tg)为第k个“square feature map”的大小，![](https://cdn.nlark.com/yuque/__latex/658190c87f05e6cb769fd7217d0b8256.svg#card=math&code=i%2Cj%20%5Cin%20%5B0%2C%20%7Cf_k%7C%5D&id=zHOQk)，这个公式3.8是一个归一化坐标，最终会映射到原图上，以确定原图上对应的区域，**加0.5的目的是将default box中心设在与之关联的cell的中心**，如图3.12所示。<br />							![](https://cdn.nlark.com/yuque/__latex/d55176c5b7ce300fcc7a16647290a0bd.svg#card=math&code=w%5E%7B%5Calpha%7D_k%3Ds_k%20%5Csqrt%7B%5Calpha_%7B%5Cgamma%7Dh%5E%7B%5Calpha%7D_k%7D%3D%5Cfrac%7Bs_k%7D%7B%5Calpha_%7B%5Cgamma%7D%7D&id=S0E6w)（公式3.7）<br />						![](https://cdn.nlark.com/yuque/__latex/15ee987a7671a19bbe035db8ca04678f.svg#card=math&code=%28%5Cfrac%7Bi%2B0.5%7D%7B%7Cf_k%7C%7D%2C%5Cfrac%7Bj%2B0.5%7D%7B%7Cf_k%7C%7D%29&id=n2jp5)（公式3.8）<br />![](https://cdn.nlark.com/yuque/0/2022/jpeg/26708373/1647345601111-82792477-e57b-443c-be54-b8513c0f8a60.jpeg#crop=0&crop=0&crop=1&crop=1&height=185&id=op0P9&originHeight=319&originWidth=700&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=406)<br />图3.11 default box尺寸的选择[3]<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345602031-316b93c7-4625-4727-af56-a0a754cd6db4.png#crop=0&crop=0&crop=1&crop=1&height=194&id=SksT8&originHeight=396&originWidth=941&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=462)<br />图3.12 default box中心坐标<br />**4. Hard negative mining**<br />生成的default box中，大部分都是负样本，正样本数量较少，导致了严重的“类别不均衡”问题，训练时难以收敛。根据confidence loss对负样本排序，选择损失最高的一部分保留（最可能不包含物体的），是的正负样本保持“1：3”的比例。SSD使用该策略获得了稳定的训练性能，加快了训练速度。<br />**5. Data augmentation**<br />在原有的数据上进行数据增强操作，以增强算法对不同尺寸和宽高比物体的鲁棒性、增强模型对目标平移的敏感度。策略如下：<br />（1）使用整张原图作为输入<br />（2）在原图上采样一个patch<br />	与目标的IoU值为0.1，0.3，0.5，0.7 or 0.9<br />	与原图的比例在[0.1, 1]之间<br />	aspect ratio在[1/2, 2]之间<br />（3）每张图片随机采样1个patch<br />（4）对采样得到的patch会被resize到固定大小，以0.5的概率进行水平翻转
<a name="UPkpN"></a>
# 4 Experimental Results

---

<a name="XyvEv"></a>
## 4.1 Base network
（1）SSD 的主干网络基于VGG-16，截取cong5_3之前的结构作为主干网络的一部分，conv5_3之后添加了**6个**具有不同尺寸特征图的卷积模块组：conv6/7替换两个FC层、新增conv8/9/10/114层，如图3.13所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345603121-29233e42-abd6-4363-a748-0e4e85db87fd.png#crop=0&crop=0&crop=1&crop=1&height=256&id=CWZB2&originHeight=697&originWidth=1460&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=536)<br />图3.13 VGG-16卷积结构<br />（2）训练超级参数设置<br />	VGG-16在ILSVRC CLS-LOC数据集上预训练。<br />	learning rate：0.001，每个训练集的初始有细小的区别<br />	momentum：0.9<br />	weight decay：0.0005<br />	batch size：32
<a name="4vMZu"></a>
## 4.2 Model analysis
**1. Data augmentation is crucial**<br />数据增强策略获得了8.8的mAP增长，如表3.1所示。<br />表3.1 不同策略对SSD性能影响<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345603627-b56106a5-609f-4c38-ae24-d89bab9892e0.png#crop=0&crop=0&crop=1&crop=1&height=114&id=REPH7&originHeight=155&originWidth=491&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=361)<br />**2. More default box shapes is better**<br />生成多个不同尺寸的default box有利于提升SSD性能。当去除{1/3，3}的宽高比后，性能降低0.6%，当进一步去除{1/2，2}的宽高比后，性能降低2.1%，如表3.1所示。<br />**3. Atrous is faster**<br />如果采用完整的VGG-16，保持pool5的“2x2 s=2”，并添加conv5_3进行预测，结果大致相同，但是速度慢了约20%。<br />**4. Multiple output layers at different resolutions is better**<br />SSD的一个主要特点是将不同尺寸的特征图送入检测器。为了验证其对提升SSD性能起了重要作用，论文做了消融实验，如表3.2所示。每减少一个输入特征图，就在剩余特征图上堆叠更多尺寸的default box、调整宽高比，以保持总的default box数量为8732。<br />当仅使用分辨率低的特征图时，SSD的性能会受到很大影响，原因可能是没有大的box来覆盖大的物体；当使用分辨率较高的特征图时，SSD性能会增强；当只使用conv7预测时，SSD性能最差，验证了不同尺寸特征图对SSD性能提升有很大贡献。<br />SSD没有采用ROI Pooling层，所以在处理低分辨率特征图时没有崩溃（当ROI Pooling的输入特征图大小 < ROI Pooling输出特征图时，算法崩溃）。<br />**SSD通过结合不同尺寸的特征图，实现了与Faster R-CNN相当的准确率，同时能够使用较低分辨率的输入图像。**<br />表3.2 不同主干网络的结构性能比较<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345604177-3d39ad8b-af09-4457-9213-17477cd087ef.png#crop=0&crop=0&crop=1&crop=1&height=150&id=Zs01N&originHeight=228&originWidth=719&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=474)
<a name="xtLWb"></a>
## 4.3 Data Augmentation for Small Object Accurac
SSD没有采用特征重采样，即在feature layer后再进行特征提取，使得SSD对于小目标检测比较困难。本文的数据增强方法对提高SSD检测小目标的性能有很重要的帮助，特别在PASCAL这类小数据集上。<br />随机裁剪相当于对图片上某一部分进行了“zoom in（放大）”操作，使得目标可以变得比较大，也会产生较多的大目标样例。此外，还是需要保留部分小目标，为了产生“zoom out（缩小）”效果，将原始图片放置在16倍原图大小的画布上，周围空间填充图片均值，然后进行随机裁剪。使用该策略获得了更多的训练熟练数据。实验效果如表3.3所示。<br />表3.3 数据增强对SSD性能影响<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345604749-4843b512-8a0c-4dbf-af99-189349f06261.png#crop=0&crop=0&crop=1&crop=1&height=122&id=Pj37K&originHeight=178&originWidth=753&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=515)
<a name="JKMD3"></a>
# 5 训练与测试

---

<a name="OQGli"></a>
## 5.1 训练
SSD训练流程如图3.14所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345605373-4ab97381-771e-43e9-b116-b89269da60a6.png#crop=0&crop=0&crop=1&crop=1&height=243&id=i4hxE&originHeight=409&originWidth=980&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=583)<br />图3.14 SSD训练流程[2]
<a name="2f3c5"></a>
## 5.2 测试
SSD测试流程，部分与训练是一致的，主要参考参考文献[4]。<br />**1. SSD整体测试结构**<br />如图15所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345605968-9556eded-99b2-4195-ac80-eb994edf7ef1.png#crop=0&crop=0&crop=1&crop=1&height=292&id=cE0TB&originHeight=509&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=539)<br />图3.15 SSD整体测试结构<br />2. 检测器和分类器<br />为图16中红框部分，详细结构如图**所示。可知，检测器和分类器都是由卷积操作构成的。假设某个用于预测的feature map是5×5×256的， default box=3，那么用于定位的卷积层输出是 5×5×12 的（4×3=12，每个通道代表一个位置因素（x,y,w,h）），用于分类的卷积层输出是 5×5×63的（21×3=63，每个通道代表一个类别）[2]<br />每个用于预测的feature map后面可以认为接了三个并行的层，一个default box generator，一个detector，一个classifier。<br />	![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345606518-7f2e8c71-4dba-4af6-b445-411a9b0c00ca.png#crop=0&crop=0&crop=1&crop=1&height=320&id=n9ECY&originHeight=538&originWidth=944&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=562)<br />图3.16 检测器、分类器<br />3. 生成default box<br />如图17所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345607369-8ca1247e-62af-4d4e-976d-227791d86188.png#crop=0&crop=0&crop=1&crop=1&height=256&id=qt3Qk&originHeight=297&originWidth=552&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=476)<br />图3.17 生成default box<br />4. 检测器和分类器对某个default box的回归<br />如图18所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345608049-7e348f86-13c7-4081-8d9a-ddb8af5df621.png#crop=0&crop=0&crop=1&crop=1&height=227&id=ebjWp&originHeight=284&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=472)<br />图3.18检测器和分类器对某个default box的回归<br />5. 得到某个特征图的bbox<br />某个特征图的所有bbox回归后，经过NMS筛选，如图19所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345608469-e68ee778-abea-42cc-9dcd-53e94bcd6c8c.png#crop=0&crop=0&crop=1&crop=1&height=228&id=LWyID&originHeight=311&originWidth=643&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=472)<br />图3.19得到某个特征图的bbox<br />6. 得到最终bbox<br />所有特征图的bbox都生成，汇总后再进行一次NMS，得到SSD最终的检测结果。如图20所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345608832-f0cacf60-98f2-46c9-b03b-964e3106159a.png#crop=0&crop=0&crop=1&crop=1&height=272&id=wicOU&originHeight=509&originWidth=939&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=501)<br />图3.20得到最终bbox
<a name="ek9g5"></a>
# 6 SSD未理解的点

---

（1）在“Data augmentation”中，在原图上采样一个patch，不明白怎么使其与目标的IoU值为0.1，0.3，0.5，0.7 or 0.9，待分析源码。
<a name="QBoMk"></a>
# 7 SSD思维导图

---

思维导图如图3.20所示。<br />![](https://cdn.nlark.com/yuque/0/2022/png/26708373/1647345609574-8c8c596d-4523-42ae-9d3c-95b854a6da08.png#crop=0&crop=0&crop=1&crop=1&height=485&id=gLgSw&originHeight=1136&originWidth=1268&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=&width=541)<br />图3.20 SSD思维导图
<a name="I6iQx"></a>
# 8 参考文献

---

[1] Liu W, Anguelov D, Erhan D, et al. SSD: Single Shot MultiBox Detector[J]. In European conference on computer vision, pages 21–37.Springer, 2016.<br />[2] 目标检测-SSD-Single Shot MultiBox Detector-论文笔记 <br />	[https://arleyzhang.github.io/articles/786f1ca3/](https://arleyzhang.github.io/articles/786f1ca3/)<br />[3] 解读SSD目标检测算法<br />	[https://zhuanlan.zhihu.com/p/32702478](https://zhuanlan.zhihu.com/p/32702478)<br />[4] SSD讲解幻灯片 <br />[https://docs.google.com/presentation/d/1rtfeV_VmdGdZD5ObVVpPDPIODSDxKnFSU0bsN_rgZXc/pub?start=false&loop=false&delayms=3000&slide=id.g178a005570_0_18477](https://docs.google.com/presentation/d/1rtfeV_VmdGdZD5ObVVpPDPIODSDxKnFSU0bsN_rgZXc/pub?start=false&loop=false&delayms=3000&slide=id.g178a005570_0_18477)

